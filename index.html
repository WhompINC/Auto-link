<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SDU Shield Explorer</title>
  <style>
    html, body { height:100%; margin:0; font-family: monospace; background:#1e1e1e; color:#ddd; }
    .grid { display: grid; grid-template-columns: 250px 1fr; grid-template-rows: auto auto 1fr; grid-template-areas:
               "sidebar header"
               "sidebar controls"
               "sidebar viewer"; height:100%; }
    #sidebar { grid-area: sidebar; background:#2d2d2d; padding:10px; overflow-y:auto; }
    #sidebar ul { list-style:none; padding:0; margin:0; }
    #sidebar li { padding:4px; cursor:pointer; transition:background .2s; }
    #sidebar li:hover { background:#3a3a3a; }
    #header { grid-area: header; display:flex; align-items:center; background:#333; padding:8px; }
    #controls { grid-area: controls; display:flex; align-items:center; background:#333; padding:4px 8px; }
    #viewer { grid-area: viewer; padding:12px; overflow-y:auto; background:#252526; }
    button, input { background:#444; border:none; color:#fff; padding:4px 8px; margin-right:8px; }
    input { flex:1; background:#222; }
    .item { display:inline-block; width:120px; margin:8px; text-align:center; cursor:pointer; }
    .icon { font-size:32px; }
    .name { margin-top:4px; font-size:14px; word-break:break-word; color:#ddd; }
  </style>
</head>
<body>
  <div class="grid">
    <div id="sidebar"><h3>Files</h3><ul id="tree"></ul></div>
    <div id="header"><button id="refresh">üîÑ</button><span id="path">Loading...</span></div>
    <div id="controls"><input id="search" placeholder="Search..." autofocus /><button id="search-btn">üîç</button></div>
    <div id="viewer"><pre id="doc-view">Select a file or folder</pre></div>
  </div>
  <script>
    const GIST_URL = 'https://gist.githubusercontent.com/WhompINC/cdfaad8036ec458507db2eb66da8de2c/raw/f60e8d360b2460d8e44ea648a58bb2ab3cf2d491/file_tree.json';
    let treeData={}, hist=[], pos=-1;
    const treeEl=document.getElementById('tree'), viewer=document.getElementById('viewer'),
          docView=document.getElementById('doc-view'), pathEl=document.getElementById('path'),
          refreshBtn=document.getElementById('refresh'), searchEl=document.getElementById('search'),
          searchBtn=document.getElementById('search-btn');

    async function loadTree(){
      try{
        const res=await fetch(GIST_URL+'?cb='+Date.now()), data=await res.json();
        treeData=data; renderSidebar(); navigate(Object.keys(data)[0]);
      }catch(e){ pathEl.textContent='Failed to load tree'; console.error(e); }
    }
    function renderSidebar(){
      treeEl.innerHTML=''; for(const [env,node] of Object.entries(treeData)){
        const li=document.createElement('li'); li.textContent=env; li.onclick=e=>navigate(env);
        treeEl.append(li);
      }
    }
    async function navigate(path){
      hist.push(path); pos=hist.length-1; updateNav(); pathEl.textContent=path;
      const [env,...rest]=path.split('/'); let node=treeData[env]; rest.forEach(r=>node=node[r]);
      viewer.innerHTML=''; if(typeof node==='object'){
        for(const [n,v] of Object.entries(node)){ showItem(env+'/'+n,v); }
      } else {
        try{ const r=await fetch(path), t=await r.text(); viewer.innerHTML='<pre>'+t+'</pre>'; }
        catch{ docView.textContent='Error loading file'; }
      }
    }
    function showItem(full,val){
      const name=full.split('/').pop(), ext=name.split('.').pop(), icon='üìÑ';
      const div=document.createElement('div'); div.className='item';
      div.innerHTML=`<div class="icon">${icon}</div><div class="name">${name}</div>`;
      div.onclick=_=>navigate(full); viewer.append(div);
    }
    function updateNav(){/* no nav buttons here */ }
    refreshBtn.onclick=loadTree; searchBtn.onclick=_=>{}; searchEl.onkeydown=e=>{};
    window.onload=loadTree;
  </script>
</body>
</html>