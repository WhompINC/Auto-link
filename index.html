<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SDU Shield Explorer</title>
  <style>
    html, body { height:100%; margin:0; font-family: monospace; background:#1e1e1e; color:#ddd; }
    .grid { display:grid; grid-template-columns:250px 1fr; grid-template-rows:auto auto 1fr;
      grid-template-areas:"sidebar header" "sidebar controls" "sidebar viewer"; height:100%; }
    #sidebar { grid-area:sidebar; background:#2d2d2d; padding:10px; overflow-y:auto; }
    #sidebar h3 { margin:0 0 8px; color:#ccc; }
    #sidebar ul, #sidebar ul ul { list-style:none; padding:0; margin:0; }
    #sidebar ul ul { display:none; margin-left:16px; }
    #sidebar li { padding:4px 8px 4px 24px; position:relative; cursor:pointer; user-select:none; transition:background .1s; }
    #sidebar li.folder::before { content:'▶'; position:absolute; left:8px; }
    #sidebar li.folder.expanded::before { content:'▼'; }
    #sidebar li.file::before { position:absolute; left:8px; }
    /* file-type emojis */
    #sidebar li.file.png::before{content:'🖼️';}#sidebar li.file.jpg::before{content:'🖼️';}#sidebar li.file.jpeg::before{content:'🖼️';}
    #sidebar li.file.gif::before{content:'🖼️';}#sidebar li.file.zip::before{content:'🗜️';}#sidebar li.file.html::before{content:'🌐';}
    #sidebar li.file.css::before{content:'🎨';}#sidebar li.file.json::before{content:'🗃️';}#sidebar li.file.ini::before{content:'⚙️';}
    #sidebar li.file.c::before{content:'💻';}#sidebar li.file.h::before{content:'💻';}#sidebar li.file.txt::before{content:'📄';}
    #sidebar li.file.md::before{content:'📝';}#sidebar li.file.py::before{content:'🐍';}#sidebar li.file.js::before{content:'📜';}
    #sidebar li:hover{background:#3a3a3a;}#sidebar li:active{background:#555;}
    #header{grid-area:header;display:flex;align-items:center;background:#333;padding:8px;border-bottom:1px solid #444;}
    #header button{background:#444;color:#fff;border:none;padding:4px 8px;margin-right:8px;cursor:pointer;transition:background .1s,transform .1s;}
    #header button:hover{background:#555;}#header button:active{background:#777;transform:translateY(1px);}#header button:disabled{opacity:.4;cursor:default;}
    #path{flex:1;color:#569cd6;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    #controls{grid-area:controls;display:flex;align-items:center;background:#333;padding:4px 8px;border-bottom:1px solid #444;}
    #controls input{flex:1;background:#222;border:1px solid #444;color:#ddd;padding:4px 8px;transition:border-color .2s;}
    #controls input:focus{border-color:#569cd6;outline:none;}#controls button{background:#444;color:#fff;border:none;padding:4px 8px;margin-left:8px;cursor:pointer;transition:background .1s,transform .1s;}
    #controls button:hover{background:#555;}#controls button:active{background:#777;transform:translateY(1px);}
    #viewer{grid-area:viewer;padding:12px;overflow-y:auto;background:#252526;}
    .item{display:inline-block;width:120px;margin:8px;text-align:center;cursor:pointer;transition:background .1s,transform .1s;position:relative;}
    .item:hover{background:#3a3a3a;} .item:active{background:#555;transform:translateY(1px);}
    .icon{font-size:32px;} .name{margin-top:4px;font-size:14px;word-break:break-word;}
    .download-btn{position:absolute;bottom:4px;right:4px;background:transparent;border:none;font-size:16px;color:#0e639c;cursor:pointer;transition:background .1s,transform .1s;}
    .download-btn:hover{background:#555;} .download-btn:active{background:#777;transform:translateY(1px);}
    pre{white-space:pre-wrap;background:#1e1e1e;padding:8px;border:1px solid #444;color:#ddd;}
  </style>
</head>
<body>
  <div class="grid">
    <div id="sidebar"><h3>📁 Files</h3><ul id="tree"></ul></div>
    <div id="header"><button id="back">◀</button><button id="forward">▶</button><span id="path">Loading...</span></div>
    <div id="controls"><button id="refresh">🔄</button><input id="search" placeholder="Search..."><button id="search-btn">🔍</button></div>
    <div id="viewer"><pre id="doc-view">Select a file or folder</pre></div>
  </div>
  <script>
    const icons={png:'🖼️',jpg:'🖼️',jpeg:'🖼️',gif:'🖼️',zip:'🗜️',html:'🌐',css:'🎨',json:'🗃️',ini:'⚙️',c:'💻',h:'💻',txt:'📄',md:'📝',py:'🐍',js:'📜'};
    let treeData={},hist=[],pos=-1,filters={env:null,exts:[],names:[],text:[]};
    const treeEl=document.getElementById('tree'),viewer=document.getElementById('viewer'),docView=document.getElementById('doc-view'),
          pathEl=document.getElementById('path'),backBtn=document.getElementById('back'),fwdBtn=document.getElementById('forward'),
          searchEl=document.getElementById('search'),searchBtn=document.getElementById('search-btn'),refreshBtn=document.getElementById('refresh');
    async function fetchTree(){
      try{let r=await fetch('https://whompinc.github.io/Files/file_tree.json?cb='+Date.now());if(!r.ok)throw 0;return await r.json();}
      catch{try{let l=await fetch('file_tree.json?cb='+Date.now());if(!l.ok)throw 0;return await l.json();}catch{throw 0;}}
    }
    async function loadTree(){try{treeData=await fetchTree();renderSidebar();navigate(Object.keys(treeData)[0]);}catch{pathEl.textContent='Error loading tree';}}
    function renderSidebar(){treeEl.innerHTML='';Object.entries(treeData).forEach(([e,n])=>{let li=document.createElement('li'),ul=document.createElement('ul');li.textContent=e;li.classList.add('folder');ul.style.display='none';buildNode(n,ul,e,li);li.appendChild(ul);treeEl.appendChild(li);});}
    function buildNode(o,ul,p,pl){Object.entries(o).forEach(([n,v])=>{let full=p+'/'+n,li=document.createElement('li');li.textContent=n;if(typeof v==='object'){li.classList.add('folder');let su=document.createElement('ul');su.style.display='none';buildNode(v,su,full,li);li.appendChild(su);li.addEventListener('click',e=>{e.stopPropagation();let ex=su.style.display==='none';li.classList.toggle('expanded',ex);su.style.display=ex?'block':'none';navigate(full);});}else{li.classList.add('file',n.split('.').pop().toLowerCase());li.addEventListener('click',e=>{e.stopPropagation();navigate(full);});}ul.appendChild(li);});}
    async function navigate(path,push=true){if(push&&hist[pos]!==path){hist=hist.slice(0,pos+1);hist.push(path);pos=hist.length-1;updateNav();}pathEl.textContent=path;viewer.innerHTML='';let[env,...r]=path.split('/'),node=treeData[env];r.forEach(x=>node=node[x]);if(typeof node==='object')Object.entries(node).forEach(([n,v])=>showItem(env+'/'+n,v));else try{viewer.innerHTML=`<pre>${await(await fetch(path)).text()}</pre>`;}catch{docView.textContent='Error loading file';}syncExpand(path);}
    function showItem(f,v){let n=f.split('/').pop(),e=n.split('.').pop().toLowerCase(),ic=typeof v==='object'?'📁':icons[e]||'📄',d=document.createElement('div');d.className='item';d.innerHTML=`<div class="icon">${ic}</div><div class="name">${n}</div>`;d.addEventListener('click',()=>navigate(f));if(typeof v!=='object'){let btn=document.createElement('button');btn.className='download-btn';btn.textContent='⬇️';btn.addEventListener('click',ev=>{ev.stopPropagation();fetch(f).then(r=>r.blob()).then(b=>{let url=URL.createObjectURL(b),a=document.createElement('a');a.href=url;a.download=n;document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);});});d.appendChild(btn);}viewer.appendChild(d);}
    function syncExpand(path){let parts=path.split('/'),sel='#tree > li';parts.forEach((p,i)=>{document.querySelectorAll(sel).forEach(li=>{if(li.firstChild.textContent===p&&i<parts.length-1){li.classList.add('expanded');let c=li.querySelector('ul');if(c)c.style.display='block';}});sel+=' > ul > li';});}
    function updateNav(){backBtn.disabled=pos<=0;fwdBtn.disabled=pos>=hist.length-1;}backBtn.onclick=()=>{if(pos>0)navigate(hist[--pos],false);};fwdBtn.onclick=()=>{if(pos<hist.length-1)navigate(hist[++pos],false);};
    refreshBtn.addEventListener('click',loadTree);searchEl.addEventListener('input',applySearch);searchBtn.addEventListener('click',applySearch);
    function applySearch(){let raw=searchEl.value.trim().toLowerCase();filters={env:null,exts:[],names:[],text:[]};raw.split(/\s+/).forEach(tok=>{if(tok==='l/'||tok==='local:')filters.env='directory_GPT';else if(tok==='v/'||tok==='virtual:')filters.env='virtual';else if(tok.startsWith('file.')||tok.startsWith('f.'))filters.names.push(tok.split('.')[1]);else if(tok.startsWith('.'))filters.exts.push(tok.slice(1));else if(tok)filters.text.push(tok);});let out=[];function w(o,p){Object.entries(o).forEach(([n,v])=>{let fp=p+'/'+n,ex=n.split('.').pop().toLowerCase();if(typeof v==='object')return w(v,fp);if(filters.env&&p!==filters.env)return;if(filters.exts.length&&!filters.exts.includes(ex))return;if(filters.names.length&&!filters.names.some(f=>n.includes(f)))return;if(filters.text.length&&!filters.text.every(t=>fp.includes(t)))return;out.push([fp,v]);});}Object.entries(treeData).forEach(([e,n])=>{if(!filters.env||filters.env===e)w(n,e);});viewer.innerHTML='';if(out.length)out.forEach(([fp,v])=>showItem(fp,v));else viewer.innerHTML=`<pre>No matches for “${searchEl.value}”</pre>`;}window.onload=loadTree;
  </script>
</body>
</html>
