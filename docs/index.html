<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SDU Shield Explorer</title>
  <style>
    html, body { height:100%; margin:0; font-family: monospace; background:#1e1e1e; color:#ddd; }
    .grid {
      display: grid;
      grid-template-columns: 200px 1fr;
      grid-template-rows: auto auto 1fr;
      grid-template-areas:
        "projects pathsearch"
        "projects controls"
        "projects viewer";
      height:100%;
    }
    #projects {
      grid-area: projects;
      background:#2d2d2d;
      padding:10px;
      overflow-y:auto;
    }
    #projects h3 {
      display:flex; justify-content:space-between; align-items:center;
    }
    #projects button { background:transparent; border:none; color:#9CDCFE; cursor:pointer; }
    #pathsearch {
      grid-area: pathsearch;
      display:flex; align-items:center;
      background:#333; padding:8px; border-bottom:1px solid #444;
    }
    #pathsearch.highlight { background:#444; }
    #back-btn, #forward-btn {
      background:#444; color:#fff; border:none; padding:4px 8px; margin-right:6px; cursor:pointer;
    }
    #back-btn:hover, #forward-btn:hover { background:#555; }
    #path-display {
      flex-shrink:0; color:#569cd6; cursor:pointer; margin-right:16px;
    }
    #controls {
      grid-area: controls;
      display:flex; align-items:center; padding:6px 8px; background:#2a2a2a; border-bottom:1px solid #444;
    }
    #env-toggle {
      background:#444; color:#fff; border:none; padding:4px 10px; cursor:pointer; margin-right:12px;
    }
    #env-toggle.active { background:#0e639c; }
    #search {
      flex:1; background:#222; color:#ddd; border:1px solid #444; padding:4px 8px;
    }
    #viewer {
      grid-area: viewer;
      padding:12px; overflow-y:auto;
    }
    .file-item {
      display:flex; justify-content:space-between; align-items:center;
      padding:6px 0; border-bottom:1px solid #2d2d2d;
    }
    .file-item a { color:#569cd6; text-decoration:none; }
    .file-item a:hover { text-decoration:underline; }
    .download-btn {
      background:transparent; border:none; font-size:18px;
      cursor:pointer; color:#0e639c;
    }
    .download-btn:hover { color:#1177bb; }
    #doc-view {
      white-space: pre-wrap; background:#252526; padding:8px;
      border:1px solid #444; margin-top:12px; min-height:200px;
    }
    button.conf {
      background:#444; color:#fff; border:none; width:100%; padding:6px; margin-top:8px; cursor:pointer;
    }
    button.conf:hover { background:#555; }
  </style>
</head>
<body>
  <div class="grid">
    <!-- Projects / Shortcuts pane -->
    <div id="projects">
      <h3>📂 Projects <button onclick="editProjects()">✏️</button></h3>
      <ul id="projects-list"></ul>
      <h3 style="margin-top:16px">🔧 Icons <button onclick="editIcons()">✏️</button></h3>
    </div>

    <!-- Combined Path + Search bar -->
    <div id="pathsearch">
      <button id="back-btn">◀</button>
      <button id="forward-btn">▶</button>
      <strong id="path-display">Path: C:</strong>
    </div>

    <!-- Environment toggle + Search control -->
    <div id="controls">
      <button id="env-toggle">[LOCAL]</button>
      <input id="search" placeholder="🔍 Search..." />
    </div>

    <!-- Main viewer -->
    <div id="viewer">
      <div id="doc-view"></div>
    </div>
  </div>

  <script>
    // ─── Defaults ────────────────────────────────────────────────────────────────
    const DEFAULT_FS = {
      LOCAL: {
        "C:": { type:"folder", children:["Projects","Files"] },
        "C:/Projects": { type:"folder", children:["SDU-Shield","Virtual"] },
        "C:/Projects/SDU-Shield": { type:"folder", children:["index.html"] },
        "C:/Projects/SDU-Shield/index.html": { type:"file" },
        "C:/Projects/Virtual": { type:"folder", children:[] },
        "C:/Files": { type:"folder", children:["directory_GPT.html","README.md"] },
        "C:/Files/directory_GPT.html": { type:"file" },
        "C:/Files/README.md": { type:"file" }
      },
      VIRTUAL: {
        "VIRTUAL:": { type:"folder", children:["SDU-Shield","Virtual"] },
        "VIRTUAL:/SDU-Shield": { type:"folder", children:["index.html"] },
        "VIRTUAL:/SDU-Shield/index.html": { type:"file" },
        "VIRTUAL:/Virtual": { type:"folder", children:[] }
      }
    };
    const DEFAULT_ICONS = { folder:"📁", file:"📄" };

    let fsStore = JSON.parse(localStorage.getItem("fsStore") || "{}");
    if (!fsStore.LOCAL) {
      fsStore = DEFAULT_FS;
      localStorage.setItem("fsStore", JSON.stringify(fsStore));
    }
    let icons = JSON.parse(localStorage.getItem("icons") || "{}");
    if (!icons.folder) {
      icons = DEFAULT_ICONS;
      localStorage.setItem("icons", JSON.stringify(icons));
    }

    let env     = localStorage.getItem("env") || "LOCAL";
    let current = env === "LOCAL" ? "C:" : "VIRTUAL:";

    // ─── History (Back/Forward) ─────────────────────────────────────────────────
    let hist = [], pos = -1;
    const backBtn    = document.getElementById("back-btn");
    const forwardBtn = document.getElementById("forward-btn");

    function updateNav() {
      backBtn.disabled    = pos <= 0;
      forwardBtn.disabled = pos >= hist.length - 1;
    }
    function pushHist(p) {
      hist = hist.slice(0, pos + 1);
      hist.push(p);
      pos++;
      updateNav();
    }
    backBtn.onclick    = () => { if (pos > 0) navigate(hist[--pos], false); };
    forwardBtn.onclick = () => { if (pos < hist.length - 1) navigate(hist[++pos], false); };
    window.onmousedown = e => {
      if (e.button === 3) backBtn.click();
      if (e.button === 4) forwardBtn.click();
    };

    // ─── Element refs ────────────────────────────────────────────────────────────
    const projList   = document.getElementById("projects-list");
    const pathDisp   = document.getElementById("path-display");
    const searchEl   = document.getElementById("search");
    const viewDiv    = document.getElementById("viewer");
    const docView    = document.getElementById("doc-view");
    const pathSearch = document.getElementById("pathsearch");
    const envToggle  = document.getElementById("env-toggle");
    const controls   = document.getElementById("controls");

    // ─── Render Projects ─────────────────────────────────────────────────────────
    function renderProjects() {
      projList.innerHTML = "";
      (fsStore[env]["C:"].children || []).forEach(name => {
        const li = document.createElement("li");
        const a  = document.createElement("a");
        a.href = "#"; a.textContent = name;
        a.onclick = e => { e.preventDefault(); navigate("C:" + "/" + name); };
        li.appendChild(a);
        projList.appendChild(li);
      });
    }
    function editProjects() {
      const curr = fsStore[env]["C:"].children.join(",");
      const inp  = prompt("Edit Projects (comma-separated):", curr);
      if (inp !== null) {
        fsStore[env]["C:"].children = inp.split(",").map(s => s.trim()).filter(Boolean);
        localStorage.setItem("fsStore", JSON.stringify(fsStore));
        renderProjects();
        navigate("C:");
      }
    }

    // ─── Edit Icons ─────────────────────────────────────────────────────────────
    function editIcons() {
      const pairs = Object.entries(icons).map(([k,v]) => k + ":" + v).join(",");
      const inp   = prompt("Edit icons ext:emoji (ex: file:📄,folder:📁):", pairs);
      if (inp !== null) {
        icons = {};
        inp.split(",").forEach(p => {
          const [k,v] = p.split(":");
          if (k && v) icons[k.trim()] = v.trim();
        });
        localStorage.setItem("icons", JSON.stringify(icons));
        navigate(current);
      }
    }

    // ─── Environment Toggle ────────────────────────────────────────────────────
    function setEnv(e) {
      env = e;
      localStorage.setItem("env", env);
      current = env === "LOCAL" ? "C:" : "VIRTUAL:";
      envToggle.textContent = `[${env}]`;
      navigate(current);
    }
    envToggle.onclick = () => setEnv(env === "LOCAL" ? "VIRTUAL" : "LOCAL");

    // ─── Render Contents / Search ───────────────────────────────────────────────
    function renderContents(path) {
      viewDiv.innerHTML = "";
      const q = searchEl.value.trim().toLowerCase();
      const children = fsStore[env][path].children || [];
      const list = q
        ? children.filter(n => n.toLowerCase().includes(q))
        : children;

      // Display folders/files
      list.forEach(name => {
        const full  = path + (path.endsWith(":") ? "/" : "/") + name;
        const entry = fsStore[env][full];
        const row   = document.createElement("div");
        row.className = "file-item";

        // Link
        const a = document.createElement("a");
        a.href = "#";
        a.textContent = (entry.type === "folder" ? icons.folder : icons.file) + " " + name;
        a.onclick = e => { e.preventDefault(); navigate(full); };
        row.appendChild(a);

        // Download for files
        if (entry.type === "file") {
          const dl = document.createElement("button");
          dl.className = "download-btn";
          dl.textContent = "📥";
          dl.onclick = () => window.open(`https://whompinc.github.io/${full}`, "_blank");
          row.appendChild(dl);
        }
        viewDiv.appendChild(row);
      });

      // If single file and not searching, preview content
      if (!q && fsStore[env][path].type === "file") {
        fetch(`https://whompinc.github.io/${path}`)
          .then(r => r.text())
          .then(txt => { docView.textContent = txt; });
      } else {
        docView.textContent = "";
      }
    }

    // ─── Navigate handler ──────────────────────────────────────────────────────
    function navigate(path, push = true) {
      if (push) pushHist(path);
      current = path;
      pathDisp.textContent = "Path: " + path;
      renderContents(path);
    }

    // ─── Highlight path/search box ─────────────────────────────────────────────
    searchEl.onfocus = () => pathSearch.classList.add("highlight");
    searchEl.onblur  = () => pathSearch.classList.remove("highlight");
    searchEl.oninput = () => renderContents(current);

    // ─── Initialization ─────────────────────────────────────────────────────────
    window.onload = () => {
      renderProjects();
      envToggle.textContent = `[${env}]`;
      navigate(current);
    };
  </script>
</body>
</html>
