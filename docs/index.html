<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SDU Shield Explorer</title>
  <style>
    html, body { height:100%; margin:0; font-family: monospace; background:#1e1e1e; color:#ddd; }
    .grid {
      display: grid;
      grid-template-columns: 200px 1fr;
      grid-template-rows: auto 1fr;
      grid-template-areas:
        "projects pathsearch"
        "projects viewer";
      height:100%;
    }
    #projects {
      grid-area: projects;
      background:#2d2d2d;
      padding:10px;
      overflow-y:auto;
    }
    #pathsearch {
      grid-area: pathsearch;
      background:#333;
      border-bottom:1px solid #444;
      padding:8px;
      display:flex;
      align-items:center;
    }
    #pathsearch.highlight { background:#444; }
    #path-display { color:#569cd6; cursor:pointer; margin-right:16px; }
    #search {
      flex:1;
      padding:4px 8px;
      background:#222;
      border:1px solid #444;
      color:#ddd;
      margin-left:auto;
    }
    #viewer {
      grid-area: viewer;
      padding:8px;
      overflow-y:auto;
    }
    .file-item {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:4px 0;
      border-bottom:1px solid #2d2d2d;
    }
    .file-item a { color:#569cd6; text-decoration:none; }
    .file-item a:hover { text-decoration:underline; }
    .download-btn {
      font-size:18px;
      background:transparent;
      border:none;
      color:#0e639c;
      cursor:pointer;
    }
    .download-btn:hover { color:#1177bb; }
    .highlight { background:#444; }
  </style>
</head>
<body>
  <div class="grid">
    <div id="projects">
      <h3>📂 Projects</h3>
      <ul id="projects-list"></ul>
    </div>
    <div id="pathsearch">
      <button id="back-btn">◀</button>
      <button id="forward-btn">▶</button>
      <strong id="path-display">Path: C:</strong>
      <input id="search" placeholder="🔍" />
    </div>
    <div id="viewer"></div>
  </div>

  <script>
    // File-system and icons defaults
    const DEFAULT_FS = {
      LOCAL: {
        "C:": { type:"folder", children:["Projects","Files"] },
        "C:/Projects": { type:"folder", children:["SDU-Shield","Virtual"] },
        "C:/Projects/SDU-Shield": { type:"folder", children:["index.html"] },
        "C:/Projects/SDU-Shield/index.html": { type:"file" },
        "C:/Projects/Virtual": { type:"folder", children:[] },
        "C:/Files": { type:"folder", children:["directory_GPT.html","README.md"] },
        "C:/Files/directory_GPT.html": { type:"file" },
        "C:/Files/README.md": { type:"file" }
      }
    };
    let fsStore = JSON.parse(localStorage.getItem("fsStore")||"{}");
    if (!fsStore.LOCAL) {
      fsStore = DEFAULT_FS;
      localStorage.setItem("fsStore", JSON.stringify(fsStore));
    }
    let env = "LOCAL", current = "C:";

    // History
    let historyStack = [], historyPos = -1;
    function pushHistory(path) {
      historyStack = historyStack.slice(0,historyPos+1);
      historyStack.push(path);
      historyPos++;
      updateNav();
    }
    function updateNav() {
      backBtn.disabled = historyPos<=0;
      forwardBtn.disabled = historyPos>=historyStack.length-1;
    }
    backBtn.onclick =()=>{ if(historyPos>0) navigate(historyStack[--historyPos],false); };
    forwardBtn.onclick =()=>{ if(historyPos<historyStack.length-1) navigate(historyStack[++historyPos],false); };
    window.onmousedown = e=>{ if(e.button===3) backBtn.click(); if(e.button===4) forwardBtn.click(); };

    // Elements
    const projectsList = document.getElementById("projects-list"),
          pathDisplay  = document.getElementById("path-display"),
          searchInput  = document.getElementById("search"),
          viewer       = document.getElementById("viewer"),
          pathBox      = document.getElementById("pathsearch"),
          backBtn      = document.getElementById("back-btn"),
          forwardBtn   = document.getElementById("forward-btn");

    // Render Projects pane
    function renderProjects() {
      projectsList.innerHTML="";
      (fsStore[env]["C:"]["children"]||[]).forEach(name=>{
        const li=document.createElement("li"),
              a =document.createElement("a");
        a.href="#"; a.textContent=name;
        a.onclick=e=>{e.preventDefault(); navigate("C:/"+name);};
        li.appendChild(a); projectsList.appendChild(li);
      });
    }

    // Render folder contents or file preview
    function renderContents(path) {
      viewer.innerHTML="";
      const q = searchInput.value.trim().toLowerCase();
      const children = fsStore[env][path].children||[];
      const list = q
        ? children.filter(n=>n.toLowerCase().includes(q))
        : children;
      list.forEach(name=>{
        const full=path+(path.endsWith(":")?"":"/")+name,
              entry=fsStore[env][full],
              row=document.createElement("div");
        row.className="file-item";
        const a=document.createElement("a");
        a.href="#"; a.textContent=(entry.type==="folder"?"📁 ":"📄 ")+name;
        a.onclick=e=>{e.preventDefault(); navigate(full);};
        row.appendChild(a);
        if(entry.type==="file") {
          const dl=document.createElement("button");
          dl.className="download-btn"; dl.textContent="📥";
          dl.onclick=()=>window.open(`https://whompinc.github.io/${full}`,"_blank");
          row.appendChild(dl);
        }
        viewer.appendChild(row);
      });
    }

    // Navigate handler
    function navigate(path, push=true) {
      if(push) pushHistory(path);
      current=path;
      pathDisplay.textContent="Path: "+path;
      renderContents(path);
    }

    // Highlight path/search box on focus
    searchInput.onfocus = ()=>pathBox.classList.add("highlight");
    searchInput.onblur  = ()=>pathBox.classList.remove("highlight");
    searchInput.oninput = ()=>renderContents(current);

    // Initialize
    renderProjects();
    navigate("C:");
  </script>
</body>
</html>
