<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SDU Shield Explorer</title>
  <style>
    html, body { height:100%; margin:0; font-family: monospace; background:#1e1e1e; color:#ddd; }
    .grid {
      display:grid;
      grid-template-columns: 250px 1fr;
      grid-template-rows: auto auto 1fr;
      grid-template-areas:
        "sidebar header"
        "sidebar controls"
        "sidebar viewer";
      height:100%;
    }
    #sidebar {
      grid-area: sidebar;
      background:#2d2d2d; padding:10px; overflow-y:auto;
    }
    #sidebar h3 { margin-top:0; }
    #sidebar ul { list-style:none; padding-left:10px; margin:0; }
    #sidebar li { cursor:pointer; user-select:none; margin:4px 0; }
    #sidebar li::before { content:"‚ñ∫ "; }
    #sidebar li.expanded::before { content:"‚ñº "; }
    #sidebar li.file::before { content:"üìÑ "; }

    #header {
      grid-area: header;
      display:flex; align-items:center;
      background:#333; padding:8px; border-bottom:1px solid #444;
    }
    #header.highlight { background:#444; }
    #back-btn, #forward-btn, #env-toggle, #search-btn {
      background:#444; color:#fff; border:none; padding:4px 8px; margin-right:8px; cursor:pointer;
    }
    #back-btn.disabled, #forward-btn.disabled { opacity:.4; cursor:default; }
    #path-display {
      display:flex; align-items:center;
      color:#569cd6; cursor:pointer; margin-right:16px;
      white-space: nowrap; overflow: hidden;
      text-overflow: ellipsis;
      max-width: 400px; /* Set fixed size */
    }
    #path-display span { margin-right:4px; }
    #path-display span:hover { text-decoration:underline; }
    #env-toggle.active { background:#0e639c; }
    #search-btn { font-size:18px; padding:4px; }
    #search {
      flex:1; background:#222; color:#ddd; border:1px solid #444;
      padding:4px 8px; margin-left:4px;
    }

    #controls { grid-area: controls; }

    #viewer {
      grid-area: viewer;
      padding:12px; overflow-y:auto;
      background: #252526;
      border: 1px solid #444;
      color: #ddd;
      white-space: pre-wrap;
    }
    .file-item {
      display:flex; justify-content:space-between; align-items:center;
      padding:6px 0; border-bottom:1px solid #2d2d2d;
    }
    .file-item a { color:#569cd6; text-decoration:none; font-size:16px; }
    .file-item a:hover { text-decoration:underline; }
    .download-btn {
      background:transparent; border:none; font-size:20px; color:#0e639c; cursor:pointer;
    }
    .download-btn:hover { color:#1177bb; }

    #doc-view {
      white-space:pre-wrap; background:#252526; padding:8px; border:1px solid #444;
      margin-top:12px; min-height:200px;
    }
    #copy-btn {
      margin-top:8px; background:#0e639c; border:none; color:#fff; padding:4px 8px; cursor:pointer;
      display:none;
    }
    #copy-btn:hover { background:#1177bb; }
  </style>
</head>
<body>
  <div class="grid">
    <div id="sidebar">
      <h3>üìÅ File Tree</h3>
      <ul id="path-tree"></ul>
    </div>

    <div id="header">
      <button id="back-btn">‚óÄ</button>
      <button id="forward-btn">‚ñ∂</button>
      <div id="path-display"></div>
      <button id="env-toggle">[LOCAL]</button>
      <button id="search-btn">üîç</button>
      <input id="search" placeholder="Search..." />
    </div>

    <div id="controls"></div>

    <div id="viewer">
      <div id="doc-view">Loading content...</div>
      <button id="copy-btn">Copy</button>
    </div>
  </div>

  <script>
    // Dummy data
    const treeData = {
      "C:": {
        "1st semester p": {},
        "ArduinoCodes": {
          "ControllerArc": {
            ".pio": {},
            "build": {
              "nanoatmega.hex": "file",
              "nanoatmega.bin": "file"
            },
            "libdeps": {}, ".vscode": {}, "__MACOSX": {}, "include": {}, "lib": {},
            "src": { "main.c": "file" },
            "test": {}
          }
        },
        "Virtual": {}
      },
      "VIRTUAL:": {
        "VirtualProject": {
          "docs": { "overview.md": "file" },
          "src": { "app.py": "file" }
        }
      }
    };

    // State & refs
    let env = "LOCAL", current = "C:";
    let hist = [], pos = -1;
    const treeRoot = document.getElementById("path-tree"),
          pathDisp = document.getElementById("path-display"),
          backBtn  = document.getElementById("back-btn"),
          fwdBtn   = document.getElementById("forward-btn"),
          envToggle= document.getElementById("env-toggle"),
          searchBtn= document.getElementById("search-btn"),
          searchEl = document.getElementById("search"),
          viewer   = document.getElementById("viewer"),
          docView  = document.getElementById("doc-view"),
          copyBtn  = document.getElementById("copy-btn"),
          header   = document.getElementById("header");

    // History functions
    function updateNav(){
      backBtn.disabled = pos<=0;
      fwdBtn.disabled  = pos>=hist.length-1;
      backBtn.classList.toggle("disabled", backBtn.disabled);
      fwdBtn.classList.toggle("disabled", fwdBtn.disabled);
    }
    function pushHist(p){
      hist=hist.slice(0,pos+1);
      hist.push(p);
      pos++;
      updateNav();
      localStorage.setItem("lastPath", p);  // Save path to localStorage
    }
    backBtn.onclick    = ()=>{ if(pos>0) navigate(hist[--pos], false); };
    fwdBtn.onclick     = ()=>{ if(pos<hist.length-1) navigate(hist[++pos], false); };
    window.onmousedown = e=>{
      if(e.button===3) backBtn.click();
      if(e.button===4) fwdBtn.click();
    };

    // Build Tree
    function buildTree(node, ul, prefix=""){
      for(const key in node){
        const li = document.createElement("li");
        li.textContent = key;
        ul.appendChild(li);
        const childUl = document.createElement("ul");
        childUl.style.display="none";
        li.appendChild(childUl);

        if(typeof node[key]==="object"){
          li.classList.add("folder");
          li.onclick = e=>{
            e.stopPropagation();
            const exp = li.classList.toggle("expanded");
            childUl.style.display = exp ? "block" : "none";
            navigate(prefix ? prefix + "/" + key : key);
          };
          buildTree(node[key], childUl, prefix ? prefix + "/" + key : key);
        } else {
          li.classList.add("file");
          li.onclick = e=>{
            e.stopPropagation();
            navigate(prefix ? prefix + "/" + key : key);
          };
        }
      }
    }

    // Path handling
    function navigate(path, push=true){
      if(push) pushHist(path);
      current = path;
      pathDisp.innerHTML = "";
      const pathSegments = path.split("/").slice(-3); // Show the last 3 segments
      pathSegments.forEach((seg, i) => {
        const span = document.createElement("span");
        span.textContent = seg;
        span.onclick = () => navigate(path.split("/").slice(0, i + 1).join("/"));
        pathDisp.appendChild(span);
      });

      renderContents(path);
    }

    // Render contents or file preview
    function renderContents(path) {
      viewer.innerHTML = "";
      const q = searchEl.value.trim().toLowerCase();
      const children = fsStore[env][path].children || [];
      const list = q ? children.filter(n => n.toLowerCase().includes(q)) : children;

      list.forEach(name => {
        const full = path + (path.endsWith(":") ? "/" : "/") + name;
        const entry = fsStore[env][full];
        const row = document.createElement("div");
        row.className = "file-item";
        const a = document.createElement("a");
        a.href = "#";
        a.textContent = (entry === "file" ? "üìÑ " : "üìÅ ") + name;
        a.onclick = e => { e.preventDefault(); navigate(full); };
        row.appendChild(a);
        if (entry === "file") {
          const dl = document.createElement("button");
          dl.className = "download-btn";
          dl.textContent = "üì•";
          dl.onclick = () => window.open(`https://whompinc.github.io/${full}`, "_blank");
          row.appendChild(dl);
        }
        viewer.appendChild(row);
      });

      // Preview single file if not searching
      if (!q && fsStore[env][path] === "file") {
        docView.textContent = `Contents of ${path}`;
        viewer.appendChild(docView);
        copyBtn.style.display = "inline-block";
      }
    }

    // Search function
    searchBtn.onclick = () => {
      const q = searchEl.value.trim().toLowerCase();
      renderContents(current);
    };

    // Copy preview
    copyBtn.onclick = () => navigator.clipboard.writeText(docView.textContent);

    // Highlight header on click
    pathDisp.onclick = () => header.classList.toggle("highlight");

    // Env toggle
    envToggle.onclick = () => {
      env = env === "LOCAL" ? "VIRTUAL" : "LOCAL";
      envToggle.textContent = `[${env}]`;
      navigate(env === "LOCAL" ? "C:" : "VIRTUAL:");
    };

    // Init
    window.onload = () => {
      buildTree(treeData["C:"], treeRoot, "C:");
      navigate(current);
    };
  </script>
</body>
</html>
