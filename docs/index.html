<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SDU Shield Explorer</title>
  <style>
    html, body { height:100%; margin:0; font-family: monospace; background:#1e1e1e; color:#ddd; }
    .grid {
      display: grid;
      grid-template-columns: 200px 1fr;
      grid-template-rows: auto auto 1fr;
      grid-template-areas:
        "projects header"
        "projects controls"
        "projects viewer";
      height:100%;
    }
    /* Projects pane */
    #projects {
      grid-area: projects;
      background:#2d2d2d;
      padding:10px;
      overflow-y:auto;
    }
    #projects h3 {
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    #projects button {
      background:transparent;
      border:none;
      color:#9CDCFE;
      cursor:pointer;
    }
    #projects-list a {
      color:#9CDCFE;
      text-decoration:none;
      display:block;
      margin:4px 0;
      padding-left:4px;
    }
    #projects-list a:hover { text-decoration:underline; }

    /* Header: combined path + controls + search */
    #header {
      grid-area: header;
      background:#333;
      border-bottom:1px solid #444;
      display:flex;
      align-items:center;
      padding:8px;
    }
    #header.highlight { background:#444; }
    #back-btn, #forward-btn {
      background:#444; color:#fff; border:none; padding:4px 8px; margin-right:6px; cursor:pointer;
    }
    #back-btn.disabled, #forward-btn.disabled {
      opacity:0.4; cursor: default;
    }
    #path-display {
      display:flex;
      align-items:center;
      color:#569cd6;
      cursor:pointer;
      margin-right:16px;
    }
    #path-display span {
      margin-right:4px;
    }
    #path-display span:hover { text-decoration:underline; }
    #env-toggle {
      background:#444; color:#fff; border:none; padding:4px 10px; cursor:pointer; margin-right:12px;
    }
    #env-toggle.active { background:#0e639c; }
    #search {
      flex:1;
      background:#222;
      color:#ddd;
      border:1px solid #444;
      padding:4px 8px;
      margin-left:auto;
    }

    /* Viewer pane */
    #viewer {
      grid-area: viewer;
      padding:12px;
      overflow-y:auto;
    }
    .file-item {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:6px 0;
      border-bottom:1px solid #2d2d2d;
    }
    .file-item a {
      color:#569cd6;
      text-decoration:none;
      font-size:18px;
    }
    .file-item a:hover { text-decoration:underline; }
    .download-btn {
      background:transparent;
      border:none;
      font-size:20px;
      color:#0e639c;
      cursor:pointer;
    }
    .download-btn:hover { color:#1177bb; }

    /* Document preview + copy */
    #doc-view {
      white-space: pre-wrap;
      background:#252526;
      padding:8px;
      border:1px solid #444;
      margin-top:12px;
      min-height:200px;
    }
    #copy-btn {
      margin-top:8px;
      background:#0e639c;
      border:none;
      color:#fff;
      padding:4px 8px;
      cursor:pointer;
    }
    #copy-btn:hover { background:#1177bb; }
  </style>
</head>
<body>
  <div class="grid">
    <div id="projects">
      <h3>üìÇ Projects <button onclick="editProjects()">‚úèÔ∏è</button></h3>
      <ul id="projects-list"></ul>
      <h3 style="margin-top:16px">üîß Icons <button onclick="editIcons()">‚úèÔ∏è</button></h3>
    </div>

    <div id="header">
      <button id="back-btn" onclick="goBack()">‚óÄ</button>
      <button id="forward-btn" onclick="goForward()">‚ñ∂</button>
      <div id="path-display"></div>
      <button id="env-toggle" onclick="toggleEnv()">[LOCAL]</button>
      <input id="search" placeholder="üîç" />
    </div>

    <div id="viewer"></div>
  </div>

  <script>
    const DEFAULT_FS = {
      LOCAL: {
        "C:": { type:"folder", children:["Projects","Files"] },
        "C:/Projects": { type:"folder", children:["SDU-Shield","Virtual"] },
        "C:/Projects/SDU-Shield": { type:"folder", children:["index.html"] },
        "C:/Projects/SDU-Shield/index.html": { type:"file" },
        "C:/Projects/Virtual": { type:"folder", children:[] },
        "C:/Files": { type:"folder", children:["directory_GPT.html","README.md"] },
        "C:/Files/directory_GPT.html": { type:"file" },
        "C:/Files/README.md": { type:"file" }
      },
      VIRTUAL: {
        "VIRTUAL:": { type:"folder", children:["SDU-Shield","Virtual"] },
        "VIRTUAL:/SDU-Shield": { type:"folder", children:["index.html"] },
        "VIRTUAL:/SDU-Shield/index.html": { type:"file" },
        "VIRTUAL:/Virtual": { type:"folder", children:[] }
      }
    };
    const DEFAULT_ICONS = { folder:"üìÅ", file:"üìÑ" };

    let fsStore = JSON.parse(localStorage.getItem("fsStore") || "{}");
    if (!fsStore.LOCAL) {
      fsStore = DEFAULT_FS;
      localStorage.setItem("fsStore", JSON.stringify(fsStore));
    }
    let icons = JSON.parse(localStorage.getItem("icons") || "{}");
    if (!icons.folder) {
      icons = DEFAULT_ICONS;
      localStorage.setItem("icons", JSON.stringify(icons));
    }

    let env = localStorage.getItem("env") || "LOCAL";
    let current = env === "LOCAL" ? "C:" : "VIRTUAL:";

    // History
    let hist = [], pos = -1;

    function updateNav() {
      backBtn.disabled = pos <= 0;
      forwardBtn.disabled = pos >= hist.length - 1;
    }

    function pushHist(p) {
      hist = hist.slice(0, pos + 1);
      hist.push(p);
      pos++;
      updateNav();
    }

    function goBack() {
      if (pos > 0) navigate(hist[--pos], false);
    }

    function goForward() {
      if (pos < hist.length - 1) navigate(hist[++pos], false);
    }

    // Refs
    const projList = document.getElementById("projects-list");
    const pathDisp = document.getElementById("path-display");
    const searchEl = document.getElementById("search");
    const viewer = document.getElementById("viewer");
    const docView = document.getElementById("doc-view");
    const copyBtn = document.getElementById("copy-btn");
    const pathSearch = document.getElementById("header");

    // Render Projects
    function renderProjects() {
      projList.innerHTML = "";
      (fsStore[env]["C:"].children || []).forEach(name => {
        const li = document.createElement("li");
        const a = document.createElement("a");
        a.href = "#";
        a.textContent = name;
        a.onclick = e => { e.preventDefault(); navigate("C:" + "/" + name); };
        li.appendChild(a);
        projList.appendChild(li);
      });
    }

    function editProjects() {
      const curr = fsStore[env]["C:"].children.join(",");
      const inp = prompt("Edit Projects (comma-separated):", curr);
      if (inp !== null) {
        fsStore[env]["C:"].children = inp.split(",").map(s => s.trim()).filter(Boolean);
        localStorage.setItem("fsStore", JSON.stringify(fsStore));
        renderProjects();
        navigate("C:");
      }
    }

    // Edit Icons
    function editIcons() {
      const pairs = Object.entries(icons).map(([k, v]) => k + ":" + v).join(",");
      const inp = prompt("Edit icons, exts:emoji (ex: file:üìÑ,folder:üìÅ):", pairs);
      if (inp !== null) {
        icons = {};
        inp.split(",").forEach(p => {
          const [k, v] = p.split(":");
          if (k && v) icons[k.trim()] = v.trim();
        });
        localStorage.setItem("icons", JSON.stringify(icons));
        navigate(current);
      }
    }

    // Env toggle
    function toggleEnv() {
      env = (env === "LOCAL" ? "VIRTUAL" : "LOCAL");
      localStorage.setItem("env", env);
      current = (env === "LOCAL" ? "C:" : "VIRTUAL:");
      envToggle.textContent = `[${env}]`;
      navigate(current);
    }

    // Render contents or file preview
    function renderContents(path) {
      viewer.innerHTML = "";
      const q = searchEl.value.trim().toLowerCase();
      const children = fsStore[env][path].children || [];
      const list = q
        ? children.filter(n => n.toLowerCase().includes(q))
        : children;

      list.forEach(name => {
        const full = path + (path.endsWith(":") ? "/" : "/") + name,
              entry = fsStore[env][full],
              row = document.createElement("div");
        row.className = "file-item";

        const a = document.createElement("a");
        a.href = "#";
        a.textContent = (entry.type === "folder" ? icons.folder : icons.file) + " " + name;
        a.onclick = e => { e.preventDefault(); navigate(full); };
        row.appendChild(a);

        if (entry.type === "file") {
          const dl = document.createElement("button");
          dl.className = "download-btn";
          dl.textContent = "üì•";
          dl.onclick = () => window.open(`https://whompinc.github.io/${full}`, "_blank");
          row.appendChild(dl);
        }
        viewer.appendChild(row);
      });

      // Preview single file if not searching
      if (!q && fsStore[env][path].type === "file") {
        fetch(`https://whompinc.github.io/${path}`)
          .then(r => r.text())
          .then(txt => { docView.textContent = txt; });
        copyBtn.style.display = "inline-block";
      } else {
        docView.textContent = "";
        copyBtn.style.display = "none";
      }
    }

    // Navigate
    function navigate(path, push = true) {
      if (push) pushHist(path);
      current = path;
      pathDisp.innerHTML = "";
      path.split("/").forEach((seg, i) => {
        const acc = path.split("/").slice(0, i + 1).join("/");
        const span = document.createElement("span");
        span.textContent = seg || "/";
        span.onclick = () => navigate(acc);
        pathDisp.appendChild(span);
      });
      renderContents(path);
    }

    // Initialize
    window.onload = () => {
      renderProjects();
      envToggle.textContent = `[${env}]`;
      navigate(current);
    };
  </script>
</body>
</html>
